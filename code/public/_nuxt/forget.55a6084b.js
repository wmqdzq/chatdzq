import{a as O,e as T,r as p,b as z,J as F,f as P,h as f,i,y as o,j as a,k as s,F as h,l as c,x as b,B as U,m as D,a2 as G,C as A,D as j,o as u,u as L,A as x,c as W,U as q,V as J,G as K}from"./entry.d811778a.js";import{l as H}from"./loginbg.ebcd0f03.js";import Q from"./imageCode.cd26929d.js";import"./_commonjsHelpers.86de73f2.js";import"./_commonjs-dynamic-modules.302442b1.js";const v=m=>(A("data-v-8e46ee08"),m=m(),j(),m),X={class:"login-main"},Y={class:"logo"},Z=["src"],ee={class:"login-area"},te=v(()=>o("div",{class:"title-name"},"找回密码",-1)),oe=v(()=>o("div",{class:"title-sub"},"通过手机号验证",-1)),ae=v(()=>o("div",{class:"title-name"},"输入验证码",-1)),le={class:"title-sub"},se={key:2,class:"title-name"},ne={class:"form"},ue={class:"codeInput"},re={key:1,class:"time"},ie={class:"name"},de=v(()=>o("div",null,null,-1)),pe=v(()=>o("div",null,"返回登录",-1)),ce=O({__name:"forget",setup(m){const B=T(),e=p({captchaCode:"",step:1,phone:"",code:"",time:90,pw1:"",pw2:""}),N=z(),_=p(!1),{proxy:l}=D(),C=p(null),I=p(),w=p(H);F("authtoken").value=null,P(()=>{S()});const S=()=>{let r={advertBoardCode:"LOGIN_BACKGROUP"};l.$api1.banner_list_photo(r).then(t=>{t.resultObj.length>0&&(w.value=t.resultObj[0].advertBgPhoto)})},g=p(),E=()=>{e.value.phone.length==11&&g.value.getCodeImg(e.value.phone,"RESETTING_PASSWORD")},y=r=>{if(r==2){if(l.$isEmpty(e.value.phone))return l.$Message.error("请输入手机号");if(l.$isEmpty(g.value.captchaCode))return l.$Message.error("请输入图形验证码");clearInterval(C.value),I.value.validate(t=>{t&&(_.value=!0,l.$api.tenant_sendRegisterCode({captchaCode:g.value.captchaCode,account:e.value.phone,sendCodeType:"RESETTING_PASSWORD"}).then(()=>{_.value=!1,e.value.step=r,e.value.time=Number(e.value.time)-1,C.value=setInterval(()=>{e.value.time=Number(e.value.time)-1,e.value.time==0&&(e.value.time=90,clearInterval(C.value))},1e3)}).catch(()=>{_.value=!1}))})}if(r==4){if(l.$isEmpty(e.value.pw1)||l.$isEmpty(e.value.pw2)){l.$Message.error("密码不能为空");return}if(e.value.pw1!=e.value.pw2){l.$Message.error("两次密码不一致");return}const t={password:e.value.pw1,registerCode:e.value.code,accountNumber:e.value.phone};l.$api.resettingPassword(t).then(()=>{l.$Message.success("密码已重置,请重新登录"),B.push("/login")})}},R=()=>{if(e.value.code.length>=6){let r={accountNumber:e.value.phone,registerCode:e.value.code};l.$api.checkResettingPasswordCode(r).then(()=>{e.value.step=3})}};return(r,t)=>{const V=G,k=f("Input"),d=f("FormItem"),$=f("Button"),M=f("Form");return u(),i("div",{class:"login",style:U("background-image: url("+w.value+");")},[o("div",X,[a(V,{to:"/"},{default:s(()=>[o("div",Y,[o("img",{class:"login-main-img",src:L(N).configuration.loginLogo},null,8,Z)])]),_:1}),o("div",ee,[e.value.step==1?(u(),i(h,{key:0},[te,oe],64)):c("",!0),e.value.step==2?(u(),i(h,{key:1},[ae,o("div",le,"验证码发送至"+b(e.value.phone),1)],64)):c("",!0),e.value.step==3?(u(),i("div",se,"设置新密码")):c("",!0),o("div",ne,[a(M,{ref_key:"formValidate",ref:I,model:e.value},{default:s(()=>[e.value.step==1?(u(),i(h,{key:0},[a(d,{prop:"phone",rules:[{required:!0,message:"请输入手机号",trigger:"blur"}]},{default:s(()=>[a(k,{size:"large",modelValue:e.value.phone,"onUpdate:modelValue":t[0]||(t[0]=n=>e.value.phone=n),placeholder:"手机号",onOnChange:E},null,8,["modelValue"])]),_:1}),a(d,null,{default:s(()=>[a(Q,{ref_key:"imgCode",ref:g},null,512),a($,{onClick:t[1]||(t[1]=n=>y(2)),class:"btn",type:"primary",size:"large",loading:_.value},{default:s(()=>[x("下一步")]),_:1},8,["loading"])]),_:1})],64)):c("",!0),e.value.step==2?(u(),W(d,{key:1},{default:s(()=>[o("div",ue,[q(o("input",{placeholder:"验证码","onUpdate:modelValue":t[2]||(t[2]=n=>e.value.code=n),onInput:R},null,544),[[J,e.value.code]]),e.value.time==90?(u(),i("a",{key:0,onClick:t[3]||(t[3]=n=>y(2))},"重新发送")):(u(),i("div",re,b(e.value.time)+"秒后可重新获取",1))])]),_:1})):c("",!0),e.value.step==3?(u(),i(h,{key:2},[a(d,null,{default:s(()=>[a(k,{size:"large",type:"password",modelValue:e.value.pw1,"onUpdate:modelValue":t[4]||(t[4]=n=>e.value.pw1=n),placeholder:"设置新密码"},null,8,["modelValue"])]),_:1}),a(d,null,{default:s(()=>[a(k,{size:"large",type:"password",modelValue:e.value.pw2,"onUpdate:modelValue":t[5]||(t[5]=n=>e.value.pw2=n),placeholder:"重复密码"},null,8,["modelValue"])]),_:1}),a(d,null,{default:s(()=>[a($,{onClick:t[6]||(t[6]=n=>y(4)),class:"btn",type:"primary",size:"large"},{default:s(()=>[x("完成")]),_:1})]),_:1})],64)):c("",!0)]),_:1},8,["model"])]),o("div",ie,[de,o("div",null,[a(V,{to:"/login"},{default:s(()=>[pe]),_:1})])])])])],4)}}});const he=K(ce,[["__scopeId","data-v-8e46ee08"]]);export{he as default};
