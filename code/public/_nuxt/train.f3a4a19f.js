import{a as A,r as u,h as r,i as L,j as n,k as o,F as T,K as P,m as X,o as k,A as c,y as h,c as $,s as j,x as z,l as H,C as J,D as Q,G as Y}from"./entry.d811778a.js";import{_ as Z}from"./addBase.8fac3ed3.js";import"./_commonjsHelpers.86de73f2.js";import"./_commonjs-dynamic-modules.302442b1.js";import"./robot.23bfda18.js";const S=_=>(J("data-v-95c5f75a"),_=_(),Q(),_),ee=S(()=>h("div",{class:"modalTitle"},"训练",-1)),te={class:"content"},ae={style:{display:"flex","flex-direction":"column"}},le=S(()=>h("div",null,"系统默认分割和预处理规则",-1)),oe=A({__name:"train",setup(_,{expose:b}){const{proxy:s}=X(),p=u(!1),F=u([]),N=u([]),y=u(!1),i=u(!1),E=u(null),C=u(),t=u({request:"",knowledgeCode:"",name:"",tagType:"TEXT",type:"KNOWLEDGE_FILE",tagCode:"",level:"",tagName:""}),d=u(2),w=u([]),I=a=>{C.value="",d.value=2,t.value={request:a.content,knowledgeCode:"",name:a.name,tagType:"TEXT",type:"KNOWLEDGE_FILE",tagCode:"",level:a.level},p.value=!0,q()},q=()=>{let a={dataType:"ALL",deptCodeList:[],name:"",permissionStatus:"",robotCode:""};y.value=!0,s.$api.getKnowledgeList(a).then(e=>{F.value=e.data,y.value=!1}).catch(()=>{y.value=!1})},B=a=>{let e={knowledgeCode:a,type:"KNOWLEDGE_FILE",tagType:"",content:"",pageNo:1,pageSize:9999,tagName:""};t.value.tagCode="",N.value=[],s.$api.queryKnowledgeBaseFilePageList(e).then(v=>{N.value=v.data})},K=()=>{if(s.$isEmpty(t.value.knowledgeCode)){s.$Message.error("请选择知识库");return}if(i.value=!0,s.$isEmpty(t.value.tagCode)&&s.$isEmpty(t.value.tagName))w.value=[],s.$api.segmentContent({content:t.value.request}).then(a=>{a.data.forEach((e,v)=>{w.value.push({knowledgeCode:t.value.knowledgeCode,name:t.value.name,tagType:t.value.tagType,type:t.value.type,list:e.contentList,request:t.value.request}),v==Number(a.data.length-1)&&O()})});else{let a={code:"",content:t.value.request,knowledgecode:t.value.knowledgeCode,level:t.value.level,request:t.value.request,robotcode:"",tagCode:d.value==1?t.value.tagCode:"",tagType:"",tagName:d.value==2?t.value.tagName:"",trainFlag:!0};s.$api.addKnowledge(a).then(()=>{i.value=!1,s.$Message.success("数据训练中"),p.value=!1}).catch(()=>{i.value=!1})}},O=()=>{let a=[];w.value.forEach((e,v)=>{e.list.length>0&&(a.push({list:e.list,name:e.name,robotCode:"",knowledgeCode:e.knowledgeCode?e.knowledgeCode:"",tagType:e.tagType,type:e.type,importVectorContentReqVOS:[]}),v==Number(w.value.length-1)&&a.forEach((m,g)=>{m.list.forEach((f,V)=>{m.importVectorContentReqVOS.push({request:f,content:f}),g==Number(a.length-1)&&V==Number(m.list.length-1)&&(a.trainFlag=!0,s.$api.ai_addKnowledgeBase(a).then(()=>{i.value=!1,s.$Message.success("数据训练中"),p.value=!1}).catch(()=>{i.value=!1}))})}))})},R=a=>{C.value=a[0].name,t.value.knowledgeCode=a[0].code,B(a[0].code)},D=()=>{d.value=1,t.value.tagName=""};return b({showFn:I}),(a,e)=>{const v=r("Spin"),m=r("Input"),g=r("FormItem"),f=r("Radio"),V=r("Option"),G=r("Select"),M=r("Form"),x=r("Button"),U=P,W=Z;return k(),L(T,null,[n(U,{modelValue:p.value,"onUpdate:modelValue":e[8]||(e[8]=l=>p.value=l),"mask-closable":!1},{header:o(()=>[ee]),footer:o(()=>[n(x,{onClick:e[7]||(e[7]=l=>p.value=!1)},{default:o(()=>[c("取消")]),_:1}),n(x,{type:"primary",onClick:K,loading:i.value},{default:o(()=>[c("确定")]),_:1},8,["loading"])]),default:o(()=>[h("div",te,[n(v,{fix:"",show:y.value},{default:o(()=>[c("加载中...")]),_:1},8,["show"]),p.value?(k(),$(M,{key:0,"label-width":100,model:t.value},{default:o(()=>[n(g,{label:"导入知识库",required:""},{default:o(()=>[n(m,{placeholder:"请选择",modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=l=>C.value=l),onClick:e[1]||(e[1]=l=>E.value.showFn()),readonly:"",style:{cursor:"pointer"}},null,8,["modelValue"])]),_:1}),n(g,{label:"导入文件夹"},{default:o(()=>[h("div",ae,[n(f,{"model-value":d.value==1,onClick:e[2]||(e[2]=l=>d.value=1)},{default:o(()=>[c("知识库文件夹")]),_:1},8,["model-value"]),n(G,{modelValue:t.value.tagCode,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.tagCode=l),onOnChange:D,transfer:""},{default:o(()=>[(k(!0),L(T,null,j(N.value,l=>(k(),$(V,{class:"text-hide",style:{"max-width":"350px"},title:l.name,value:l.code,key:l.code},{default:o(()=>[c(z(l.name),1)]),_:2},1032,["title","value"]))),128))]),_:1},8,["modelValue"]),n(f,{"model-value":d.value==2,onClick:e[4]||(e[4]=l=>d.value=2),style:{"margin-top":"10px"}},{default:o(()=>[c("新建文件夹")]),_:1},8,["model-value"]),n(m,{modelValue:t.value.tagName,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.tagName=l),onInput:e[6]||(e[6]=l=>d.value=2),placeholder:"如未填写名称规则自动生成文件名,也可输入名称"},null,8,["modelValue"])])]),_:1}),n(g,{label:"处理方式"},{default:o(()=>[le]),_:1})]),_:1},8,["model"])):H("",!0)])]),_:1},8,["modelValue"]),n(W,{ref_key:"addBaseRef",ref:E,onInit:R,limit:1,systemShow:!1},null,512)],64)}}});const pe=Y(oe,[["__scopeId","data-v-95c5f75a"]]);export{pe as default};
