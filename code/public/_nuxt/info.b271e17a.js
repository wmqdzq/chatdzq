import{a as Be,r as o,b as Fe,e as ze,f as De,M as qe,N as Ye,w as Q,h as F,i as u,y as l,j as c,k as _,l as g,A as S,u as ue,F as b,s as O,c as ce,v as X,x as h,B as je,m as Je,_ as We,C as Ke,D as Qe,o as i,z as Xe,E as Ze,G as et}from"./entry.b3d0478f.js";import{_ as tt}from"./icon12.324e3958.js";import{_ as ot}from"./icon13.a12257fc.js";import{_ as at}from"./icon14.d8f5d4e2.js";import{_ as lt}from"./delete.93bc223f.js";import{_ as st}from"./icon10.dda11adf.js";import{_ as nt}from"./hot.d804d2cf.js";import{_ as it}from"./robot.23bfda18.js";import{r as ut,_ as ct}from"./recordNew.9940343d.js";import{i as rt}from"./templateNew.43c0672b.js";import"./_commonjsHelpers.86de73f2.js";import"./_commonjs-dynamic-modules.302442b1.js";import"./ossUploaderNew.bc250fbe.js";import"./upload.1da94f3c.js";import"./svga.4b61c129.js";import"./loding.3cd02d06.js";import"./stringify.f484c508.js";import"./previewImg.5ba94f0e.js";import"./cCreate.fa3fcebe.js";import"./addBase.6bac7936.js";import"./close.79d7cbfd.js";import"./curriculum.943a89fc.js";import"./unit.b72b5b5d.js";import"./edit1.66aaae0f.js";import"./copy.ac3b57f3.js";import"./switch.ceeadd7d.js";import"./content.2ef9ea5b.js";import"./avatar.476f89d8.js";import"./barrage.8a0f0b41.js";import"./close3.bdd7467f.js";const ge=z=>(Ke("data-v-b49700e0"),z=z(),Qe(),z),dt={class:"layout-main"},pt={class:"layout-main-right"},vt={class:"layout-main-right-content chatArea"},mt={class:"chatAreaNav clearfix"},ft={key:0,class:"chatOperation"},_t={key:1,class:"chatGroupList"},gt={class:"area"},ht={class:"add"},Ct=["onClick"],yt={class:"content"},Lt={class:"content-title text-hide"},Tt={class:"content-name"},Et=["onClick"],kt={class:"chatContainer"},bt={class:"selectModelList clearfix"},St={class:"item"},It={class:"multipleModelList"},$t={class:"list"},xt={class:"clearfix item"},Rt={class:"name fl"},Mt={class:"i-230 mt-10"},Nt={key:1,class:"input-area"},Pt={key:0,style:{width:"480px"}},At={key:1,class:"promptContainer"},Ot={class:"area-container"},wt=ge(()=>l("h2",null,[l("img",{src:st,alt:""}),S(" 灵感大全 ")],-1)),Ut={class:"cate"},Gt=["onClick"],Ht={key:0},Vt=["onClick"],Bt={class:"text-hide-4"},Ft={key:0,class:"hot"},zt=ge(()=>l("img",{src:nt,alt:""},null,-1)),Dt=Be({__name:"info",setup(z){const re=o(),{Modal:he}=Ze,C=Fe(),{proxy:s}=Je();o(null);const L=o(""),de=o(null),T=o(""),r=o("");o("");const Ce=o(""),d=o([]),D=o(null),R=o(""),I=o([]),q=o([]),w=o(9),Z=o(null),ee=o(120);o([]);const Y=o([]),te=o([]),m=o("");o("");const $=o(!1),M=o(!1),U=ze(),oe=o(!0),N=o(1);o(!0),o(!1);const G=o(!1),pe=o(""),P=o(!1),j=o(!1),ye=o(null),E=o({loadMore:!0,pageNo:1,pageSize:20}),H=o(!1),ae=o(!1),le=o(!1),p=o({}),se=o([]);De(()=>{s.$isLogin()?Le():s.$isEmpty(C.prompt)||U.push("/login"),ke()});const Le=async()=>{ne()},ne=()=>{let t={type:"ALMIGHTY_CHAT_ROBOT"};s.$isEmpty(U.currentRoute.value.query.code)||(L.value=U.currentRoute.value.query.code,t={code:L.value}),s.$api.space_robotGetRobotInfo(t).then(e=>{if(de.value=e.data.consumeEnergy,T.value=e.data.type,L.value=e.data.code,r.value=e.data,Ce.value=e.data.llmCode,d.value=[],s.$isEmpty(U.currentRoute.value.query.code)||(s.$isEmpty(e.data.robotPromptText)||(Y.value=e.data.robotPromptText.split("@")),s.$isEmpty(e.data.welcomeContent)||(pe.value=e.data.welcomeContent,d.value.push({content:e.data.welcomeContent,type:"SYSTEM",chatType:"CHAT",robotPromptList:Y.value||[]}))),e.data.llmCode=="20240517001"?se.value=["txt","doc","docx","pptx","pdf","xls","xlsx","jpg","jpeg","png"]:se.value=["txt","doc","docx","pptx","pdf","xls","xlsx"],!s.$isEmpty(ie.value)){x();return}J()})},Te=()=>{G.value=!G.value,te.value.forEach(t=>{t.single=G.value})},Ee=()=>{let t={code:r.value.code,llmCodeList:[]};te.value.forEach(e=>{e.single&&t.llmCodeList.push(e.code)}),s.$api.editMultiModelRobotLlmModel(t).then(e=>{H.value=!1,ne()})},J=()=>{s.$isLogin()&&(N.value=1,I.value=[],me(),B())},ke=()=>{let t={type:"PROMPT_ROBOT_CATEGORY",name:""};s.$api.queryTagTemplateListFusion(t).then(e=>{q.value=e.data})},be=()=>{w.value==9?(w.value=1e5,Z.value&&setTimeout(()=>{ee.value=Z.value.offsetHeight+50},300)):(ee.value=120,w.value=9)},Se=t=>{let e={tagInfoCode:t.code};s.$api.tagMatrixPointRecord(e),m.value=t.promptContent,M.value=!1,x()},V=o(""),ve=t=>{V.value=t,M.value=!0},Ie=o([]),$e=()=>{let t={typeList:["DOCUMENT_INTERPRETATION","HOT_CONSULTATION","COPYWRITING_CREATION"],loadTagInfoFlag:!0};s.$api.queryTagTemplateList(t).then(e=>{Ie.value=e.data})},xe=()=>{P.value=!0,B()},me=()=>{C.abortReadingStream();let t={type:T.value,robotCode:L.value};s.$api.ai_bulidChatGroupId(t).then(e=>{R.value=e.data,D.value=null,s.$isEmpty(U.currentRoute.value.query.code)?(d.value=[],$e()):d.value.length>1&&(d.value=[],d.value.push({content:pe.value,type:"SYSTEM",chatType:"CHAT",robotPromptList:Y.value||[]}))})},B=()=>{if(s.$isLogin()){let t={robotCode:L.value,type:T.value,pageNo:N.value,pageSize:20};oe.value&&!s.$isEmpty(L.value)&&s.$api.queryAiRecordGroupPageList(t).then(e=>{let n=e.data;if(N.value>1?I.value=I.value.concat(n):I.value=n,e.data&&e.data.length==0){oe.value=!1;return}})}},fe=s.$debounce(t=>{const{scrollTop:e,scrollHeight:n,clientHeight:f}=t.target;n-e-f<10&&(N.value=N.value+1,B())},300),Re=(t,e)=>{C.abortReadingStream(),E.value.pageNo=1,R.value=t,D.value=e,d.value=[],E.value.loadMore=!0,_e()},_e=()=>{let t={robotCode:L.value,groupId:R.value,pageNo:E.value.pageNo,pageSize:E.value.pageSize};E.value.loadMore&&s.$api.queryNewAiRecordPageList(t).then(e=>{if(e.data&&e.data.length==0){E.value.loadMore=!1;return}let n=[];e.data.forEach(f=>{if(!s.$isEmpty(f.attachmentList)){f.imgList=f.imgList||[],f.fileList=f.fileList||[];const A=["JPG","JPEG","PNG","GIF","BMP","WEBP"];f.attachmentList.forEach(v=>{const K={url:v.sourceUrl,code:v.code};console.log(A.includes(v.format)),A.includes(v.format)?f.imgList.push(K):f.fileList.push({name:v.fileName,url:v.sourceUrl,size:v.fileSize??1})})}}),n.unshift(...e.data.reverse()),E.value.pageNo>1?(d.value=n.concat(d.value),re.value.toMediate()):d.value=n})},Me=()=>{s.$api.space_robotModify({code:L.value,type:T.value,name:r.value.name,llmCode:r.value.llmCode,hitRate:r.value.hitRate,intelligentContactFlag:r.value.intelligentContactFlag,intelligentAgentRecommendationFlag:r.value.intelligentAgentRecommendationFlag}).then(()=>{H.value=!1,ne(),s.$Message.success("修改成功")})},Ne=()=>{$.value=!1,E.value.pageNo=E.value.pageNo+1,_e()},Pe=()=>{$.value=!1},ie=o(""),Ae=(t,e,n)=>{if(!s.$isEmpty(t)){if(e=="DOCUMENT_INTERPRETATION"){p.value.fileList=[{name:n.name,code:n.resourceCode,size:(n==null?void 0:n.size)??1}],m.value=n.promptContent,x();return}if(e=="HOT_CONSULTATION"){r.value.llmCode="170",m.value=n.promptContent,ie.value=e,Me();return}m.value=t,x()}},W=o(""),Oe=t=>{W.value=t.recordCode,m.value=t.request,x()},we=t=>{p.value.imgList=t.imgList,p.value.fileList=t.fileList,m.value=t.content,x()},x=t=>{C.abortReadingStream();let e={content:m.value,groupId:R.value,robotCode:L.value,attachmentFileCodeList:[],type:T.value,lastAiRecordCode:W.value};s.$isEmpty(W.value)&&d.value.push({content:m.value,type:"USER",chatType:"CHAT",imgList:s.$isEmpty(p.value.imgList)?[]:p.value.imgList,fileList:s.$isEmpty(p.value.fileList)?[]:p.value.fileList}),s.$isEmpty(p.value.imgList)||p.value.imgList.forEach(n=>{e.attachmentFileCodeList.push(n.code)}),s.$isEmpty(p.value.fileList)||p.value.fileList.forEach(n=>{e.attachmentFileCodeList.push(n.code)}),p.value={imgList:[],fileList:[]},ie.value="",m.value="",W.value="",C.setAiChat(s,e)};qe(()=>C.getChatMsg);const Ue=t=>{he.confirm({okText:"确定",cancelText:"取消",content:"是否删除该数据?",onOk:()=>{let e={codeList:[t.code]};$.value=!0,s.$api.deleteBatchAiRecordGroup(e).then(()=>{$.value=!1,s.$Message.success("已删除"),I.value.length==1&&(I.value=[]),Ge(),B()}).catch(()=>{$.value=!1})}})},Ge=()=>{d.value=[],m.value="",R.value=null,me()};return Ye(()=>{C.setIsShowHis(!1)}),Q(()=>C.getChatMsg,t=>{t&&t.content&&(console.log(t),s.$processChatData(d.value,t,T.value=="MULTIPLE_MODELS_CHAT"))},{deep:!0}),Q(()=>C.electric,t=>{N.value=1,oe.value=!0,D.value=0,T.value&&B()},{deep:!0}),Q(()=>P.value,()=>{C.setIsShowHis(P.value)},{immediate:!0}),Q(()=>r.value.llmCode,t=>{t=="170"?(ae.value=!0,le.value=!1):t=="126"?(le.value=!0,ae.value=!1):(ae.value=!1,le.value=!1)},{deep:!0,immediate:!0}),(t,e)=>{const n=F("Tooltip"),f=We,A=F("Button"),v=F("Icon"),K=F("Checkbox"),He=F("Poptip");return i(),u("div",dt,[l("div",pt,[l("div",vt,[l("div",mt,[P.value?g("",!0):(i(),u("div",ft,[c(f,null,{default:_(()=>[c(n,{content:"创建新对话",placement:"right"},{default:_(()=>[l("img",{onClick:J,src:tt,alt:""})]),_:1}),c(n,{content:"历史记录",placement:"right"},{default:_(()=>[l("img",{onClick:xe,src:ot,alt:""})]),_:1})]),_:1})])),P.value?(i(),u("div",_t,[l("div",gt,[l("h2",null,[S(" 历史记录 "),l("img",{style:{cursor:"pointer"},onClick:e[0]||(e[0]=a=>P.value=!1),src:at,alt:""})]),l("div",ht,[c(A,{type:"primary",size:"large",onClick:J},{default:_(()=>[S("+ 创建新对话")]),_:1})])]),l("div",{class:"info-left-list",onScroll:e[1]||(e[1]=(...a)=>ue(fe)&&ue(fe)(...a))},[(i(!0),u(b,null,O(I.value,(a,k)=>(i(),u("div",{class:X(["list-item pointer",D.value==k?"active":""]),key:k,onClick:y=>Re(a.groupId,k)},[l("div",yt,[l("div",Lt,h(a.request),1),l("div",Tt,h(a.gmtCreate),1)]),l("img",{class:"deleteIco",onClick:Xe(y=>Ue(a),["stop"]),src:lt},null,8,Et)],10,Ct))),128))],32)])):g("",!0)]),l("div",kt,[T.value=="MULTIPLE_MODELS_CHAT"?(i(),ce(He,{key:0,modelValue:H.value,"onUpdate:modelValue":e[4]||(e[4]=a=>H.value=a),class:"multipleModelSelectPoptip clearfix",placement:"bottom-end",width:"241"},{content:_(()=>[l("div",It,[l("div",$t,[(i(!0),u(b,null,O(te.value,(a,k)=>(i(),u("div",xt,[l("div",Rt,[S(h(a.name)+" ",1),l("span",null,"(-"+h(a.consumeEnergy)+"电量)",1)]),c(K,{class:"check fr",modelValue:a.single,"onUpdate:modelValue":y=>a.single=y},{default:_(()=>[S(h(""))]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),256))]),l("div",Mt,[c(K,{class:"fl",modelValue:G.value,"onUpdate:modelValue":e[2]||(e[2]=a=>G.value=a),onClick:e[3]||(e[3]=a=>Te(a))},{default:_(()=>[S("全选")]),_:1},8,["modelValue"]),c(A,{class:"fr mr-8",type:"primary",size:"small",onClick:Ee},{default:_(()=>[S("确定")]),_:1})])])]),default:_(()=>[l("div",bt,[r.value.multiModelInfoResVOS?(i(!0),u(b,{key:0},O(r.value.multiModelInfoResVOS,(a,k)=>(i(),u("div",St,h(a.name)+" ",1))),256)):g("",!0),H.value?(i(),ce(v,{key:2,class:"arrow",type:"ios-arrow-up"})):(i(),ce(v,{key:1,class:"arrow",type:"ios-arrow-down"}))])]),_:1},8,["modelValue"])):g("",!0),l("div",{class:X(["dialogue",[T.value=="MULTIPLE_MODELS_CHAT"?"multipleModelChat":"",j.value?"shareChat":""]])},[c(ut,{ref_key:"recordComRef",ref:re,isLoading:$.value,"onUpdate:isLoading":e[5]||(e[5]=a=>$.value=a),robotLogo:r.value.robotLogo||ue(it),chatList:d.value,robotPromptList:Y.value,onScrollTop:Ne,onScrollBottom:Pe,onGetContent:Ae,groupId:R.value,shareState:j.value,"onUpdate:shareState":e[6]||(e[6]=a=>j.value=a),onAnswer:Oe,onSubmit:we},null,8,["isLoading","robotLogo","chatList","robotPromptList","groupId","shareState"])],2),j.value?g("",!0):(i(),u("div",Nt,[c(n,{content:"创建新对话",class:"input-icon input-addChat iconCom",placement:"top"},{default:_(()=>[l("div",{class:"icon",onClick:J},[c(v,{type:"md-add",color:"#0090F7"})])]),_:1}),c(rt,{content:m.value,"onUpdate:content":e[7]||(e[7]=a=>m.value=a),format:se.value,uploadLists:p.value,"onUpdate:uploadLists":e[8]||(e[8]=a=>p.value=a),robotCode:r.value.code,consumeEnergy:de.value,onSubmit:x,isUoload:!0,robotInfo:r.value},null,8,["content","format","uploadLists","robotCode","consumeEnergy","robotInfo"]),c(n,{content:"找找灵感",class:"input-icon iconCom input-prompt",placement:"top"},{default:_(()=>[l("div",{class:"icon",onClick:e[9]||(e[9]=a=>M.value=!0)},[c(v,{type:"ios-bulb-outline"})])]),_:1})]))]),M.value?(i(),u("div",Pt)):g("",!0),M.value?(i(),u("div",At,[l("div",Ot,[l("div",{class:"del",onClick:e[10]||(e[10]=a=>M.value=!1)},[c(v,{class:"font20",type:"md-close"})]),wt,l("div",Ut,[l("ul",{class:"clearfix",ref_key:"cateRef",ref:Z},[l("li",{onClick:e[11]||(e[11]=a=>ve("")),class:X(V.value==""?"active":"")}," 全部 ",2),(i(!0),u(b,null,O(q.value,(a,k)=>(i(),u(b,null,[k<w.value?(i(),u("li",{key:0,class:X(V.value==a.code?"active":""),onClick:y=>ve(a.code)},h(a.cateName),11,Gt)):g("",!0)],64))),256)),l("li",{class:"more",onClick:be},h(w.value==9?"更多":"收起"),1)],512)]),l("div",{class:"list",style:je("height: calc(100% - "+ee.value+"px);")},[q.value.length>0?(i(),u("ul",Ht,[(i(!0),u(b,null,O(q.value,(a,k)=>(i(),u(b,{key:k},[V.value==""||V.value==a.code?(i(!0),u(b,{key:0},O(a.promptList,(y,Ve)=>(i(),u("li",{key:Ve,onClick:qt=>Se(y)},[l("h3",null,h(y.promptName),1),l("p",Bt,h(y.promptContent),1),t.$isEmpty(y.useCount)?g("",!0):(i(),u("div",Ft,[zt,S(" "+h(y.useCount),1)]))],8,Vt))),128)):g("",!0)],64))),128))])):g("",!0)],4)])])):g("",!0)])]),c(ct,{ref_key:"recordImgRef",ref:ye},null,512)])}}});const Eo=et(Dt,[["__scopeId","data-v-b49700e0"]]);export{Eo as default};
