import{G,r as v,f as M,h as y,o as a,i as u,F as A,j as d,y as l,z as w,x as R,q as N,c as J,k as _,A as O,B as U,H as Y,_ as Z,m as V,C as j,D as Q}from"./entry.b3d0478f.js";import{_ as H,a as L,b as T}from"./upload.1da94f3c.js";import{_ as K}from"./svga.4b61c129.js";import{l as X}from"./loding.3cd02d06.js";const P="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAAAspJREFUWEftmDGI01AYx78vvdAbLnCDww0OHW4RbkiTlFZwiOjgoOiBy4G7CIK4e6jo4CZutzkcxzkIJ+jgIBhBsDZ5bQcHhwMLOhw4CG2GO9LmkwfpEdr08pI2uROvU2i+93+//N/3vvfxEE74D084H0wEVFW1JEnSCiLOTfsRhULhV6PRcNLoRAIahnGXiJ4DwNRwHAoR9xHxvG3b7aSQY4C6rp9BxJ9ENJ9ULCZ+V1GUsmVZbhLdMUBN064i4ttA5BkAfE0iOIwlogVE3AyPRcRXjuOsJdGLcvAGAOwEIquMsTdJBIexqqouFgqFPxFj7zDGNkQ18wLcAoDrAMBdTZSPuQAi4mMA+E5E24FzwvmYG6DjOI80TdtAxNvBzhbKx1wBTdOcd133CxGpgZOx+ZgrIIfSNG0ZEVui+ZgLIABYiPgpVIIuAcAFkXzMDNA0zbler/cbABYFSsrEcpYZYLCcVxDxJQAsxUBmD8gd4xCWZfXDMMH/C6OA3W6Xn1jDkyZbQA7huu42EYGiKGujkFHu6boudGJNvcQhuJsByGsRyFwAI+CGZsVCZg54BJwQZKaAEXB8Ywyb2/DzRCczBTQMY5OIbgVWdYjoBSLyDpx3z/eJ6B4AlIL3W4yxYezhfskUUNM0Xt94z7gny/JFz/P42XrYQ8qy3PY87yOvf0S02mw234/u5EwB+WTlcvlysVjcrdfrnajJarVa6eDgYLnVan041jLDJxd1IwwqOmbqOngKmDZ50yxXmjH/xxJXKpUl3/dr3CFJkuq2be/F9YC5bpI4mGMvM6eAaXZXGtfSzBN3ebSOiJ+nhYka7/u+iYgP+TsiutZsNt9FxY0BVqvVs/1+/8es7gYFPm5/MBica7fbHSHA4Oh6AABPBMRnEbLOGHs6SWjiFbBhGCu+7xuzIJig0Zckqe04zrej5vh3L9EzdC6R9F8cUiBHZ9Rw3AAAAABJRU5ErkJggg==";const q={name:"ossUploader",props:{modeType:{type:String,default:"img"},url:{type:String,default:""},multiple:{type:Boolean,default:!1},code:{type:String,default:""},type:{type:String,default:""},format:{type:Array,default(){return[]}},limit:{type:Number,default:-1},selQty:{type:Number,default:0},maxSize:{type:Number,default:1e3},apiUrl:{type:String,default:"createTemporaryAccount"},suffix:{type:String,default:""},text:{type:String,default:""},inputTitle:{type:String,default:"未选择任何文件"}},setup(n,e){const{proxy:t}=V(),o=v(!1),r=v(null);let k=null,m=v([]);const h=v(),I=v();M(async()=>{});async function S(){try{let s={resourceQuantity:m.value.length,partyRelationshipType:n.type,partyRelationship:n.code};await t.$api[n.apiUrl](s).then(c=>{r.value=c.data}),b()}catch(s){console.error("获取accessKeySecret失败：",s)}}function b(){k=new OSS({accessKeyId:r.value.accessKeyId,accessKeySecret:r.value.accessKeySecret,stsToken:r.value.securityToken,bucket:r.value.bucketName,region:r.value.resourceUpLoadAddress})}function x(s){return n.format.length&&!n.format.includes(s.name.split(".").pop().toLocaleLowerCase())?(t.$Message.error("请上传正确格式"),!1):!0}function D(s){e.emit("update:url",s)}const B=(s,c)=>{console.log("Object的上传进度。"),console.log(s),console.log("分片上传的断点信息"),console.log(c),e.emit("schedule",s)};async function F(s){console.log(s);const c=s.target.files;if(Number(n.limit)!=-1&&Number(c.length)>Number(n.limit)){t.$Message.error("一次性上传不超过"+n.limit+"个文档"),s.target.value=null;return}if(Number(n.limit)!=-1&&Number(c.length)+Number(n.selQty)>Number(n.limit)){t.$Message.error("上传文件已超过最大限制"),s.target.value=null;return}let z=!1;for(let C=0;C<c.length;C++)if(c[C].size/1e3/1e3>n.maxSize&&(z=!0),C==c.length-1){if(z){t.$Message.error("单个文件不能超过"+n.maxSize+"MB"),s.target.value=null;return}o.value=!0;for(let g=0;g<c.length;g++){if(!x(c[g]))return;m.value.push({file:c[g],url:""})}try{e.emit("loadings"),await S();const g=[];for(let f=0;f<m.value.length;f++){const E=await k.multipartUpload(r.value.resourcePathList[f],m.value[f].file,{progress:B,headers:{"Access-Control-Allow-Origin":"*"}});g.push({url:r.value.cdnUrl+r.value.resourcePathList[f]+n.suffix,name:m.value[f].file.name,code:r.value.resourceCodeList.length>0?r.value.resourceCodeList[f]:"",size:Number(Number(m.value[f].file.size/1e3).toFixed(0))}),console.log("单个文件上传成功：",E)}m.value=[],e.emit("uploadSuccess",g),e.emit("update:url",g[0].url),s.target.value=null,o.value=!1}catch(g){Y(),console.error("文件上传失败：",g),o.value=!1,s.target.value=null,e.emit("uploadError",g)}}}return{loading:o,uploadFile:F,toDelete:()=>{e.emit("update:url","")},fileInput:h,chooseImgRef:I,chooseImgs:D,nodata:X}}},p=n=>(j("data-v-8752c65c"),n=n(),Q(),n),W={key:0,class:"cImage"},$=p(()=>l("img",{src:L,style:{width:"20px",height:"20px"}},null,-1)),ee=[$],te={class:"cImage-img"},le=p(()=>l("img",{src:T},null,-1)),oe={class:"cImage-img-name"},ie={class:"cImage-upload"},ne=["multiple"],se={key:1,class:"upload-area"},ae=p(()=>l("div",{class:"upload-btn"},[l("img",{src:T}),l("div",null,"选择文件上传")],-1)),ue=["multiple"],de={key:2,class:"upload-icon"},re=p(()=>l("div",{class:"upload-btn",style:{width:"20px",height:"20px"}},[l("img",{src:P})],-1)),ce=["multiple"],me={key:3,class:"uploadFiles"},ge=["multiple"],pe={key:4,class:"freedom"},fe=["title","multiple"],_e={key:5,class:"uploadFiles-optional"},ye=["multiple"],he=p(()=>l("img",{src:L,style:{width:"20px",height:"20px"}},null,-1)),ve=[he],Ae={key:6,class:"cImage"},we=p(()=>l("img",{src:L,style:{width:"20px",height:"20px"}},null,-1)),Ie=[we],xe=p(()=>l("div",{class:"upload"},[l("div",null,"+"),l("div",null,"上传图片")],-1)),Ce={key:7,class:"uploadFiles"},ke=p(()=>l("img",{src:T},null,-1)),Se=p(()=>l("p",null,[O("将文件拖到此处，或"),l("span",null,"点击上传")],-1)),be=["multiple"],De=["multiple"];function Be(n,e,t,o,r,k){const m=y("Image"),h=y("Spin"),I=y("DropdownItem"),S=y("DropdownMenu"),b=y("Dropdown"),x=Z,D=H,B=K,F=y("van-toast");return a(),u("div",{style:U({width:t.modeType=="optional"?"100%":"auto"})},[t.modeType=="img"?(a(),u("div",W,[t.url?(a(),u(A,{key:0},[d(m,{preview:!0,"preview-list":[t.url],class:"cImage-img",src:t.url,fit:"cover"},null,8,["preview-list","src"]),l("div",{class:"deleteImg",onClick:e[0]||(e[0]=w((...i)=>o.toDelete&&o.toDelete(...i),["stop"]))},ee)],64)):(a(),u(A,{key:1},[d(h,{fix:"",show:o.loading},null,8,["show"]),l("div",te,[le,l("div",oe,"上传"+R(t.text?"简历":"图片"),1),l("div",ie,[l("input",{class:"upload-input",type:"file",multiple:t.multiple,onChange:e[1]||(e[1]=i=>o.uploadFile(i))},null,40,ne)])])],64))])):t.modeType=="custom"?(a(),u("div",se,[ae,l("input",{class:"upload-input",type:"file",multiple:t.multiple,onChange:e[2]||(e[2]=i=>o.uploadFile(i))},null,40,ue)])):t.modeType=="icon"?(a(),u("div",de,[re,l("input",{class:"upload-input",style:{width:"24px",height:"24px"},type:"file",multiple:t.multiple,onChange:e[3]||(e[3]=i=>o.uploadFile(i))},null,40,ce)])):t.modeType=="file"?(a(),u("div",me,[N(n.$slots,"content",{},void 0,!0),l("input",{class:"upload-input",type:"file",multiple:t.multiple,onChange:e[4]||(e[4]=i=>o.uploadFile(i))},null,40,ge)])):t.modeType=="freedom"?(a(),u("div",pe,[N(n.$slots,"content",{},void 0,!0),l("input",{class:"upload-input",title:t.inputTitle,type:"file",multiple:t.multiple,onChange:e[5]||(e[5]=i=>o.uploadFile(i))},null,40,fe)])):t.modeType=="optional"?(a(),u("div",_e,[d(h,{fix:"",show:o.loading},null,8,["show"]),t.url?(a(),u(A,{key:1},[d(m,{preview:!0,"preview-list":[t.url],class:"cImage-img",src:t.url,fit:"cover"},null,8,["preview-list","src"]),l("div",{class:"deleteImg",onClick:e[7]||(e[7]=w((...i)=>o.toDelete&&o.toDelete(...i),["stop"]))},ve)],64)):(a(),u(A,{key:0},[N(n.$slots,"content",{},void 0,!0),l("input",{class:"upload-input",type:"file",multiple:t.multiple,onChange:e[6]||(e[6]=i=>o.uploadFile(i))},null,40,ye)],64))])):t.modeType=="DS"?(a(),u("div",Ae,[d(h,{fix:"",show:o.loading},null,8,["show"]),t.url?(a(),u(A,{key:0},[d(m,{preview:!0,"preview-list":[t.url],class:"cImage-img",src:t.url,fit:"cover"},null,8,["preview-list","src"]),l("div",{class:"deleteImg",onClick:e[8]||(e[8]=w((...i)=>o.toDelete&&o.toDelete(...i),["stop"]))},Ie)],64)):(a(),J(x,{key:1},{default:_(()=>[d(b,{transfer:"",trigger:"hover"},{list:_(()=>[d(S,null,{default:_(()=>[d(I,{onClick:e[9]||(e[9]=w(i=>o.fileInput.click(),["stop"]))},{default:_(()=>[O("本地上传")]),_:1}),d(I,{onClick:e[10]||(e[10]=w(i=>o.chooseImgRef.showFn(),["stop"]))},{default:_(()=>[O("从数据集选择")]),_:1})]),_:1})]),default:_(()=>[xe]),_:1})]),_:1}))])):(a(),u("div",Ce,[ke,Se,l("input",{class:"upload-input",type:"file",multiple:t.multiple,onChange:e[11]||(e[11]=i=>o.uploadFile(i))},null,40,be)])),d(x,null,{default:_(()=>[l("input",{class:"fileInput",ref:"fileInput",type:"file",multiple:t.multiple,onChange:e[12]||(e[12]=i=>o.uploadFile(i))},null,40,De)]),_:1}),d(D,{ref:"chooseImgRef",limit:1,onChoose:o.chooseImgs},null,8,["onChoose"]),d(F,{show:o.loading,"onUpdate:show":e[13]||(e[13]=i=>o.loading=i),style:{padding:"0",background:"transparent"}},{message:_(()=>[d(B,{svgaImg:o.nodata,canvasName:"loading",width:120},null,8,["svgaImg"])]),_:1},8,["show"])],4)}const Te=G(q,[["render",Be],["__scopeId","data-v-8752c65c"]]);export{Te as _};
