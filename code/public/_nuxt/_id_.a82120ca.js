import{aa as F,J as w,a as $,b as ee,e as te,r as d,P as oe,f as ne,N as se,p as ae,w as re,h as S,i as c,y as u,x as L,F as C,s as H,j as m,k as v,m as le,_ as ie,o as r,v as q,B as ce,c as W,l as T,A as ue,u as A,C as de,D as pe,G as he}from"./entry.d811778a.js";import{_ as fe}from"./robot.23bfda18.js";import{c as me}from"./content.8ac9cfa6.js";import"./_commonjsHelpers.86de73f2.js";import"./_commonjs-dynamic-modules.302442b1.js";const ve="data:image/png;base64,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";var B;function N(l,s){let n=s?w("authtokenWap").value:w("authtoken").value;return n!==void 0?n[l]:"0000"}const ge=F("webSocket",{state:()=>({websock:null,chatMsg:"",reconnectCount:0,maxReconnectCount:5,initInfo:{isWap:!1,sk:"",robotCode:"",targetUser:""}}),getters:{getChatMsg:l=>l.chatMsg},actions:{WEBSOCKET_INIT(){var l=window.location.hostname,s=l.split(".");const f="wss://wss."+(s[s.length-2]+"."+s[s.length-1])+"/space/aiCustomerService";this.websock=new WebSocket(f),console.log("WebSocket 连接中...");var g="";g=window.location.host;let i={tntInstId:N("tntInstId",this.initInfo.isWap),requestToken:"",tntBizId:N("tntBizId",this.initInfo.isWap),reqParam:{},extendParams:{},assertToken:N("assertToken",this.initInfo.isWap),sourceVersion:"1.0.0",operatorId:"",userToken:N("userToken",this.initInfo.isWap),systemCurrentTime:new Date().getTime(),pageNo:1,pageSize:20,currentPageMaxId:0,source:g,channel:"WEB",msgSource:""};this.websock.onopen=()=>{console.log("连接成功！"),i.reqParam={sk:this.initInfo.sk?this.initInfo.sk:"",robotCode:this.initInfo.robotCode?this.initInfo.robotCode:"",targetUser:this.initInfo.targetUser?this.initInfo.targetUser:"",content:"",type:"INIT"},console.log(i),this.websock.send(JSON.stringify(i)),B=setInterval(()=>{i.reqParam={sk:this.initInfo.sk?this.initInfo.sk:"",robotCode:this.initInfo.robotCode?this.initInfo.robotCode:"",targetUser:this.initInfo.targetUser?this.initInfo.targetUser:"",content:"",type:"PULSE"},console.log("心跳"),this.websock.send(JSON.stringify(i))},5e3),this.reconnectCount=0},this.websock.onmessage=a=>{console.log("ws接收！"),console.log(JSON.parse(a.data)),this.chatMsg=a},this.websock.onerror=a=>{console.log("ws错误!"),console.log(a)},this.websock.onclose=a=>{console.log("ws关闭！"),console.log(a),this.chatMsg=a,clearInterval(B),this.websock=null,a.code!=1e3&&this.reconnectCount<this.maxReconnectCount&&setTimeout(()=>{this.WEBSOCKET_RECONNECT()},3e3)}},WEBSOCKET_SEND(l){console.log("ws发送！"),console.log(l),this.websock!==null&&this.websock.readyState===WebSocket.OPEN?this.websock.send(l):console.error("WebSocket is already in CLOSING or CLOSED state.")},WEBSOCKET_CLOSE(){console.log("主动关闭"),this.websock!=null&&(clearInterval(B),this.websock.close())},WEBSOCKET_RECONNECT(){console.log("正在重连..."),this.WEBSOCKET_INIT(),this.reconnectCount++},setInitInfo(l){this.initInfo=l}}}),J=l=>(de("data-v-a101d62d"),l=l(),pe(),l),Ie={class:"preview"},ke={class:"preview-top"},ye={class:"preview-content"},Se={class:"logo"},Ce=["src"],Te={key:1,src:fe},we={key:1,src:"https://hz-oss.chatdzq.com/file/common/static-web/d638965e-dd7b-4fe9-b03b-3f39c3342d1a.png"},Ee=["src"],be={key:3},Oe=J(()=>u("h3",null,"您可以告诉我需要创作什么内容？比如下面：",-1)),Re=["onClick"],Ae={class:"preview-content-bottom"},Ne=J(()=>u("h2",null,"联系我们",-1)),Me={style:{"text-align":"center"}},xe=$({__name:"[id]",setup(l){const s=ge();ee();const{proxy:n}=le(),f=te(),g=d(0),i=d([]),a=d({}),p=d(""),M=d([]),I=d(!1);let h=oe({});ne(()=>{var t;h.sk=((t=f.currentRoute.value.params)==null?void 0:t.id)??"",K(),n.$isWapLogin()?_():I.value=!0,n.$toMonitorA()}),se(()=>{s.WEBSOCKET_CLOSE()});const K=()=>{var t;n.$api.getTeamCustomerServiceBySk({sk:((t=f.currentRoute.value.params)==null?void 0:t.id)??""}).then(e=>{a.value=e.data,n.$isEmpty(e.data.promptText)||(M.value=e.data.promptText.split("@"))})},_=()=>{var t;U(),s.setInitInfo({isWap:!0,sk:((t=f.currentRoute.value.params)==null?void 0:t.id)??"",robotCode:s.initInfo?s.initInfo.robotCode:"",targetUser:s.initInfo?s.initInfo.targetUser:""}),s.WEBSOCKET_CLOSE(),s.WEBSOCKET_INIT(!0)},X=()=>{if(n.$isEmpty(h.userName)){n.$Message.error("请输入您的姓名");return}if(n.$isEmpty(h.accountNumber)){n.$Message.error("请输入您的手机号");return}n.$api.customRegister(h).then(t=>{w("authtokenWap").value=JSON.stringify(t.data),setTimeout(()=>{_()},200),I.value=!1})},E=d(!1),Y=t=>{t.srcElement.scrollTop<10&&!E.value&&(E.value=!0,setTimeout(()=>{b.value.pageNo++,k.value.scrollTop=k.value.scrollHeight,U()},500))},b=d({pageNo:1,pageSize:20,sk:""}),U=()=>{var t;b.value.sk=((t=f.currentRoute.value.params)==null?void 0:t.id)??"",n.$api.chatRecordListWap(b.value).then(e=>{i.value.unshift(...e.data.reverse()),e.data.length>0&&(E.value=!1),e.data.length<20&&(E.value=!0),b.value.pageNo==1&&setTimeout(()=>{x()},200),i.value.length==e.totalCount&&(!n.$isEmpty(a.value.welcomeContent)||!n.$isEmpty(a.value.promptText))&&i.value.unshift({content:a.value.welcomeContent||"",type:"SYSTEM",chatType:"CHAT"})},e=>{I.value=!0,w("authtokenWap").value=null})},k=d(null),x=async()=>{await ae(),k.value.scrollTop=k.value.scrollHeight},O=t=>{let e=w("authtokenWap").value;return e!==void 0?e[t]:"0000"},z=()=>{var R;if(n.$isEmpty(p.value)){n.$Message.error("你还没有输入问题呢！");return}let t=JSON.parse(JSON.stringify(p.value));if(t=t?t.replace(/[\r\n]/g,"").trim():"",n.$isEmpty(t)){n.$Message.error("你还没有输入问题呢！");return}var e="";e=window.location.host;let y={tntInstId:O("tntInstId"),requestToken:"",tntBizId:O("tntBizId"),reqParam:{},extendParams:{},assertToken:O("assertToken"),sourceVersion:"1.0.0",operatorId:"",userToken:O("userToken"),systemCurrentTime:new Date().getTime(),pageNo:1,pageSize:20,currentPageMaxId:0,source:e,channel:"WEB",msgSource:""};y.reqParam={sk:((R=f.currentRoute.value.params)==null?void 0:R.id)??"",robotCode:"",targetUser:"",content:p.value,type:"NORMAL"},setTimeout(()=>{p.value=""},4e3),i.value.push({content:y.reqParam.content,type:"USER",chatType:"CHAT"}),x(),s.WEBSOCKET_SEND(JSON.stringify(y))};return re(()=>s.getChatMsg,t=>{if(t&&t.data){let e=JSON.parse(t.data);if(e.type=="WELCOME"){i.value.push({content:e.content,type:"SYSTEM",chatType:e.type});return}if(e.type=="SYNC")return;e.startFlag?(i.value.push({content:"",type:e.selfFlag?"USER":"SYSTEM",chatType:"CHAT"}),g.value=i.value.length-1):e.type=="ACK"?p.value="":(i.value[g.value].content+=e.content,x())}},{deep:!0,immediate:!0}),(t,e)=>{const y=S("Spin"),R=S("Image"),D=S("Input"),V=S("Button"),P=S("Modal"),G=ie;return r(),c("div",Ie,[u("div",ke,L(a.value.name),1),u("div",ye,[u("div",{class:"preview-content-main",ref_key:"chatRecordContentRef",ref:k,onScroll:Y},[(r(!0),c(C,null,H(i.value,(o,Q)=>(r(),c(C,null,[o.chatType!="WELCOME"?(r(),c("div",{key:0,class:q(["content",o.type=="SYSTEM"?"left":"right"])},[u("div",Se,[o.type=="SYSTEM"?(r(),c(C,{key:0},[a.value.robotLogo?(r(),c("img",{key:0,src:a.value.robotLogo},null,8,Ce)):(r(),c("img",Te))],64)):(r(),c("img",we))]),u("div",{class:q(["name",o.type=="SYSTEM"?"blue":""]),style:ce({"background-color":o.type=="USER"?"#17A382":"#fff"})},[t.$isEmpty(o.content)?(r(),W(y,{key:0})):(r(),c(C,{key:1},[o.chatType=="CHAT"?(r(),W(me,{key:0,isShowTagView:!1,content:o.content},null,8,["content"])):T("",!0),o.chatType=="DRAW"?(r(),W(R,{key:1,preview:!0,"preview-list":[o.content],class:"cImage-img",src:o.content,fit:"cover"},null,8,["preview-list","src"])):T("",!0),o.chatType=="VIDEO"?(r(),c("video",{key:2,width:"658",height:"444",controls:"",src:o.content},null,8,Ee)):T("",!0),Q==0&&M.value.length>0?(r(),c("div",be,[Oe,u("ul",null,[(r(!0),c(C,null,H(M.value,(Z,j)=>(r(),c("li",{key:j,onClick:De=>p.value=Z},L(Z),9,Re))),128))])])):T("",!0)],64))],6)],2)):T("",!0)],64))),256))],544),u("div",Ae,[m(D,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=o=>p.value=o),autosize:{minRows:2,maxRows:4},onOnEnter:z,placeholder:"请输入您想要咨询的问题"},{suffix:v(()=>[u("img",{onClick:z,src:ve})]),_:1},8,["modelValue"])])]),m(G,null,{default:v(()=>[m(P,{class:"chatRegister",modelValue:I.value,"onUpdate:modelValue":e[3]||(e[3]=o=>I.value=o),closable:!1,"mask-closable":!1},{header:v(()=>[Ne]),footer:v(()=>[m(V,{type:"primary",size:"large",long:"",onClick:X},{default:v(()=>[ue("确认")]),_:1})]),default:v(()=>[u("div",Me,[m(D,{size:"large",class:"mb-10",modelValue:A(h).userName,"onUpdate:modelValue":e[1]||(e[1]=o=>A(h).userName=o),placeholder:"请输入您的姓名"},null,8,["modelValue"]),m(D,{size:"large",modelValue:A(h).accountNumber,"onUpdate:modelValue":e[2]||(e[2]=o=>A(h).accountNumber=o),placeholder:"请输入您的手机号"},null,8,["modelValue"])])]),_:1},8,["modelValue"])]),_:1})])}}});const Ze=he(xe,[["__scopeId","data-v-a101d62d"]]);export{Ze as default};
