import{a as A,r as d,h as r,o as k,i as b,j as n,k as o,A as c,y as h,c as L,F as S,s as P,x as X,l as j,K as z,C as H,D as J,m as Q,G as Y}from"./entry.b3d0478f.js";import{_ as Z}from"./addBase.6bac7936.js";const T=f=>(H("data-v-5dbd7dad"),f=f(),J(),f),ee=T(()=>h("div",{class:"modalTitle"},"训练",-1)),ae={class:"content"},te={style:{display:"flex","flex-direction":"column"}},le=T(()=>h("div",null,"系统默认分割和预处理规则",-1)),oe=A({__name:"trainModal",setup(f,{expose:$}){const{proxy:s}=Q(),p=d(!1),F=d([]),N=d([]),y=d(!1),i=d(!1),V=d(null),C=d(),a=d({request:"",knowledgeCode:"",name:"",tagType:"TEXT",type:"KNOWLEDGE_FILE",tagCode:"",level:"",tagName:""}),u=d(2),w=d([]),I=t=>{C.value="",u.value=2,a.value={request:t.content,knowledgeCode:"",name:t.name,tagType:"TEXT",type:"KNOWLEDGE_FILE",tagCode:"",level:t.level},p.value=!0,q()},q=()=>{let t={dataType:"ALL",deptCodeList:[],name:"",permissionStatus:"",robotCode:""};y.value=!0,s.$api.getKnowledgeList(t).then(e=>{F.value=e.data,y.value=!1}).catch(()=>{y.value=!1})},B=t=>{let e={knowledgeCode:t,type:"KNOWLEDGE_FILE",tagType:"",content:"",pageNo:1,pageSize:9999,tagName:""};a.value.tagCode="",N.value=[],s.$api.queryKnowledgeBaseFilePageList(e).then(v=>{N.value=v.data})},K=()=>{if(s.$isEmpty(a.value.knowledgeCode)){s.$Message.error("请选择知识库");return}if(i.value=!0,s.$isEmpty(a.value.tagCode)&&s.$isEmpty(a.value.tagName))w.value=[],s.$api.segmentContent({content:a.value.request}).then(t=>{t.data.forEach((e,v)=>{w.value.push({knowledgeCode:a.value.knowledgeCode,name:a.value.name,tagType:a.value.tagType,type:a.value.type,list:e.contentList,request:a.value.request}),v==Number(t.data.length-1)&&M()})});else{let t={code:"",content:a.value.request,knowledgecode:a.value.knowledgeCode,level:a.value.level,request:a.value.request,robotcode:"",tagCode:u.value==1?a.value.tagCode:"",tagType:"",tagName:u.value==2?a.value.tagName:"",trainFlag:!0};s.$api.addKnowledge(t).then(()=>{i.value=!1,s.$Message.success("数据训练中"),p.value=!1}).catch(()=>{i.value=!1})}},M=()=>{let t=[];w.value.forEach((e,v)=>{e.list.length>0&&(t.push({list:e.list,name:e.name,robotCode:"",knowledgeCode:e.knowledgeCode?e.knowledgeCode:"",tagType:e.tagType,type:e.type,importVectorContentReqVOS:[]}),v==Number(w.value.length-1)&&t.forEach((m,g)=>{m.list.forEach((_,x)=>{m.importVectorContentReqVOS.push({request:_,content:_}),g==Number(t.length-1)&&x==Number(m.list.length-1)&&(t.trainFlag=!0,s.$api.ai_addKnowledgeBase(t).then(()=>{i.value=!1,s.$Message.success("数据训练中"),p.value=!1}).catch(()=>{i.value=!1}))})}))})},O=t=>{C.value=t[0].name,a.value.knowledgeCode=t[0].code,B(t[0].code)},R=()=>{u.value=1,a.value.tagName=""};return $({showFn:I}),(t,e)=>{const v=r("Spin"),m=r("Input"),g=r("FormItem"),_=r("Radio"),x=r("Option"),D=r("Select"),G=r("Form"),E=r("Button"),U=z,W=Z;return k(),b(S,null,[n(U,{modelValue:p.value,"onUpdate:modelValue":e[8]||(e[8]=l=>p.value=l),"mask-closable":!1},{header:o(()=>[ee]),footer:o(()=>[n(E,{onClick:e[7]||(e[7]=l=>p.value=!1)},{default:o(()=>[c("取消")]),_:1}),n(E,{type:"primary",onClick:K,loading:i.value},{default:o(()=>[c("确定")]),_:1},8,["loading"])]),default:o(()=>[h("div",ae,[n(v,{fix:"",show:y.value},{default:o(()=>[c("加载中...")]),_:1},8,["show"]),p.value?(k(),L(G,{key:0,"label-width":100,model:a.value},{default:o(()=>[n(g,{label:"导入知识库",required:""},{default:o(()=>[n(m,{placeholder:"请选择",modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=l=>C.value=l),onClick:e[1]||(e[1]=l=>V.value.showFn()),readonly:"",style:{cursor:"pointer"}},null,8,["modelValue"])]),_:1}),n(g,{label:"导入文件夹"},{default:o(()=>[h("div",te,[n(_,{"model-value":u.value==1,onClick:e[2]||(e[2]=l=>u.value=1)},{default:o(()=>[c("知识库文件夹")]),_:1},8,["model-value"]),n(D,{"transfer-class-name":"trainModalSelect",modelValue:a.value.tagCode,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.tagCode=l),onOnChange:R,transfer:""},{default:o(()=>[(k(!0),b(S,null,P(N.value,l=>(k(),L(x,{class:"text-hide",style:{"max-width":"350px"},title:l.name,value:l.code,key:l.code},{default:o(()=>[c(X(l.name),1)]),_:2},1032,["title","value"]))),128))]),_:1},8,["modelValue"]),n(_,{"model-value":u.value==2,onClick:e[4]||(e[4]=l=>u.value=2),style:{"margin-top":"10px"}},{default:o(()=>[c("新建文件夹")]),_:1},8,["model-value"]),n(m,{modelValue:a.value.tagName,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.tagName=l),onInput:e[6]||(e[6]=l=>u.value=2),placeholder:"如未填写名称规则自动生成文件名,也可输入名称"},null,8,["modelValue"])])]),_:1}),n(g,{label:"处理方式"},{default:o(()=>[le]),_:1})]),_:1},8,["model"])):j("",!0)])]),_:1},8,["modelValue"]),n(W,{ref_key:"addBaseRef",ref:V,onInit:O,limit:1,systemShow:!1},null,512)],64)}}});const de=Y(oe,[["__scopeId","data-v-5dbd7dad"]]);export{de as _};
