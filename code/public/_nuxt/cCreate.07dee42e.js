import{a as _e,r as p,e as ve,N as me,h as y,o as s,c as C,k as r,j as c,y as l,x as N,A as D,i as u,F as k,l as m,s as O,u as fe,_ as he,C as ge,D as ye,m as Ce,G as ke}from"./entry.d811778a.js";import{_ as Le}from"./ossUploaderNew.392fe014.js";import{_ as Ee}from"./svga.1e6ae788.js";import{_ as Ie}from"./addBase.8fac3ed3.js";import{_ as Te}from"./close.79d7cbfd.js";import{c as Ne}from"./curriculum.943a89fc.js";import{_ as Oe}from"./robot.23bfda18.js";import{_ as we}from"./unit.b72b5b5d.js";import{l as Ve}from"./loding.bf55ea5c.js";const L=M=>(ge("data-v-00275983"),M=M(),ye(),M),Pe={class:"header"},Ae=L(()=>l("div",null,"编辑",-1)),Me={class:"cCreate-content"},Ue={class:"content-top"},be=["src"],xe={class:"top-name"},De={class:"name"},Se={class:"remark"},Fe={class:"content-main"},Re={key:0,class:"form-item"},Be=L(()=>l("div",{class:"example",style:{padding:"0"}},"不知道写什么?",-1)),$e={class:"form-item-title"},Ge={class:"name"},qe={key:0,class:"require"},Je={key:1,class:"addType"},Ke={key:0,class:"content-upload"},Xe={class:"upload"},We={class:"upload-area"},He={key:0,class:"area-file"},ze=L(()=>l("img",{src:Ne},null,-1)),Qe=[ze],je=L(()=>l("div",null,"请上传文件，支持 PDF、Word 格式",-1)),Ye={key:1,class:"dataList"},Ze={class:"input"},ea=L(()=>l("div",{class:"input-title"},"题数",-1)),aa={class:"input"},oa=L(()=>l("div",{class:"input-title"},"总分值",-1)),ta={class:"reduce"},la={class:"knowledge-list"},sa={class:"knowledge-item"},na={class:"item-logo"},da=["src"],ua={key:1,src:Oe,alt:""},ca=["title"],ra={key:1,class:"loading-data"},ia={class:"footer"},pa={class:"footer-title"},_a=L(()=>l("img",{src:we},null,-1)),va=L(()=>l("div",{class:"title1"},"共消耗",-1)),ma={class:"title2"},fa=L(()=>l("div",{class:"title3"},"电量",-1)),ha={class:"footer-btn"},ga=_e({__name:"cCreate",emits:["ok","cancel"],setup(M,{expose:H,emit:F}){const R=p(""),z=ve(),w=p(""),V=p(!1),B=p(),{proxy:f}=Ce(),E=p(!1),$=p(""),Q=p([]),G=p(),P=p(!0),i=p([]),I=p(),U=p(null),_=p([]),q=p(null),j=p([{value:"radio",name:"单选题"},{value:"checkbox",name:"多选题"},{value:"gap",name:"填空题"},{value:"judgment",name:"判断题"},{value:"shortAnswer",name:"简答题"},{value:"calculation",name:"计算题"},{value:"essayQuestion",name:"论述题"},{value:"experimental ",name:"实验题"},{value:"essayTitle",name:"作文题"},{value:"graphQuestion",name:"图表题"},{value:"lineMatching",name:"连线匹配题"},{value:"translation",name:"翻译题"},{value:"reading",name:"阅读理解题"}]),Y=a=>{clearInterval(U.value),_.value=[],V.value=!0,E.value=!0,I.value={},f.$api.space_robotGetRobotInfo({code:a}).then(e=>{I.value=e.data,B.value=e.data.consumeEnergy,w.value=e.data.code,$.value=e.data.type;let n=e.data.questionBank;f.$isEmpty(JSON.parse(n).example)||(Q.value=JSON.parse(n).example.split(",")),P.value=!0,i.value=JSON.parse(n).columnPageItemList,i.value.length==1&&(f.$isEmpty(i.value[0].example)?P.value=!1:P.value=!0),i.value.map(o=>({...o,value:""})),i.value.forEach((o,h)=>{if(o.formType=="SELECT"||o.formType=="TABS"||o.formType=="RADIO"){let T="",A=o.attrItemJson.split(";");A.forEach((b,x)=>{x==0?T=b.split("||")[0]:T=T+";"+b.split("||")[0],x==Number(A.length-1)&&(o.attrItemJson=T,o.value=o.attrItemJson.split(";")[0])})}o.formType=="UPLOAD_FILE"&&(o.value="",P.value=!1),o.formType=="KNOWLEDGE_COMPONENT"&&(o.value="",o.knowledgeCodeList=[]),o.formType=="UPLOAD_IMAGE"&&(o.value="",o.attachmentFileCodeList=[]),h==Number(i.value.length-1)&&Z()}),oe(),E.value=!1}).catch(()=>{E.value=!1})},Z=()=>{f.$api.getQuestionBankRobotHistory({robotCode:w.value}).then(a=>{a.data&&a.data.dataMap&&i.value.forEach(e=>{e.value=a.data.dataMap[e.itemParam],e.formType=="UPLOAD_FILE"&&(e.value=""),e.formType=="KNOWLEDGE_COMPONENT"&&(e.value="",a.data.dataMap.questionBankRobotKnowledgeCodeList&&a.data.dataMap.questionBankRobotKnowledgeCodeList.length>0&&f.$api.queryKnowledgeInfoBaseList({codeList:a.data.dataMap.questionBankRobotKnowledgeCodeList}).then(n=>{e.knowledgeList=n.data,e.knowledgeCodeList=[],n.data.forEach(o=>{e.knowledgeCodeList.push(o.code)})})),e.formType=="UPLOAD_IMAGE"&&(e.value="")})})},ee=()=>{i.value.forEach(a=>{a.value=a.example})},ae=a=>{a==1&&(F("cancel"),V.value=!1),a==2&&(F("ok"),V.value=!1)},oe=()=>{let a={type:$.value,robotCode:w.value};f.$api.ai_bulidChatGroupId(a).then(e=>{G.value=e.data})},te=()=>{if(E.value)return;let a={},e=!1;if(a.knowledgeCodeList=[],a.attachmentFileCodeList=[],i.value.forEach(o=>{a[o.itemParam]=o.value?o.value:"",o.hadRequired&&f.$isEmpty(o.value)&&!e&&o.formType!="EXAMINATION_COMPONENT"&&o.formType!="KNOWLEDGE_COMPONENT"&&o.formType!="UPLOAD_IMAGE"&&(f.$Message.error("请"+(o.formType=="SELECT"?"选择":"输入")+o.itemName),e=!0),o.formType=="EXAMINATION_COMPONENT"&&o.hadRequired&&_.value.length==0&&(f.$Message.error("请选择"+o.itemName),e=!0),_.value.length!=0&&i.value.forEach(h=>{h.formType=="EXAMINATION_COMPONENT"&&(a[h.itemParam]=_.value)}),o.formType=="DATE"&&(a[o.itemParam]=f.$dateFormat(o.value,"yyyy-MM-dd")),o.formType=="KNOWLEDGE_COMPONENT"&&(a[o.itemParam]=o.knowledgeCodeList,a.knowledgeCodeList=a.knowledgeCodeList.concat(o.knowledgeCodeList),o.hadRequired&&a.knowledgeCodeList.length==0&&(f.$Message.error("请选择"+o.itemName),e=!0)),o.formType=="UPLOAD_IMAGE"&&(a.attachmentFileCodeList=a.attachmentFileCodeList.concat(o.attachmentFileCodeList),o.hadRequired&&a.attachmentFileCodeList.length==0&&(f.$Message.error("请选择"+o.itemName),e=!0))}),e)return;let n={content:a,groupId:G.value,robotCode:w.value,requestContent:a,sseStream:!0,attachmentFileCodeList:a.attachmentFileCodeList?a.attachmentFileCodeList:[],knowledgeCodeList:a.knowledgeCodeList?a.knowledgeCodeList:[]};n.content&&n.content.attachmentFileCodeList&&delete n.content.attachmentFileCodeList,n.content&&n.content.knowledgeCodeList&&delete n.content.knowledgeCodeList,E.value=!0,localStorage.removeItem("createHis"),setTimeout(()=>{localStorage.setItem("createHis",JSON.stringify(n)),U.value=setInterval(()=>{localStorage.getItem("createHis")&&(clearInterval(U.value),E.value=!1,z.push("/ai/creative/detail?robotCode="+w.value))},100)},100)},S=(a,e)=>{a=="add"&&_.value.push({type:"radio",num:1,score:1}),a=="reduce"&&_.value.splice(e,1)},le=a=>{R.value=a.itemParam,q.value.showFn()},se=a=>{i.value.forEach(e=>{e.itemParam==R.value&&(e.knowledgeCodeList=[],e.knowledgeList=[],a.forEach(n=>{e.knowledgeCodeList.push(n.code),e.knowledgeList.push(n)}))})},ne=(a,e)=>{i.value.forEach(n=>{n.itemParam==a.itemParam&&(n.knowledgeCodeList.splice(e,1),n.knowledgeList.splice(e,1))})};me(()=>{clearInterval(U.value)});const de=(a,e)=>{i.value[a].value=e[0].code},ue=(a,e)=>{i.value.forEach(n=>{n.itemParam==a.itemParam&&(n.attachmentFileCodeList=[],n.attachmentFileCodeList.push(e[0].code))})};return H({showFn:Y}),(a,e)=>{const n=y("Icon"),o=y("Input"),h=he,T=y("Option"),A=y("Select"),b=y("DatePicker"),x=y("Radio"),ce=y("RadioGroup"),J=Le,K=y("InputNumber"),X=y("Button"),re=Ee,ie=y("Modal"),pe=Ie;return s(),C(h,null,{default:r(()=>[c(ie,{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=t=>V.value=t),width:"680","mask-closable":!1,"class-name":"cCreate",closable:!1,transfer:!0},{header:r(()=>[l("div",Pe,[Ae,l("img",{src:Te,onClick:e[0]||(e[0]=t=>ae(1))})])]),footer:r(()=>[l("div",ia,[l("div",pa,[_a,va,l("div",ma,N(B.value),1),fa]),l("div",ha,[c(X,{type:"primary",class:"btn",loading:E.value,onClick:te},{default:r(()=>[D("立即生成")]),_:1},8,["loading"])])])]),default:r(()=>[l("div",Me,[E.value?(s(),u("div",ra,[c(re,{svgaImg:fe(Ve),canvasName:"loading",width:120},null,8,["svgaImg"])])):(s(),u(k,{key:0},[I.value&&I.value.code?(s(),u(k,{key:0},[l("div",Ue,[l("img",{src:I.value.robotLogo},null,8,be),l("div",xe,[l("div",De,N(I.value.name),1),l("div",Se,N(I.value.robotRemark),1)])]),l("div",Fe,[P.value?(s(),u("div",Re,[l("div",{class:"form-item-title"},[Be,l("div",{class:"href",onClick:ee},"试试示例")])])):m("",!0),(s(!0),u(k,null,O(i.value,(t,W)=>(s(),u("div",{class:"form-item",key:W},[l("div",$e,[l("div",Ge,N(t.itemName),1),t.hadRequired?(s(),u("div",qe,"*")):m("",!0),t.formType=="EXAMINATION_COMPONENT"?(s(),u("div",Je,[c(n,{class:"addBtn",type:"ios-add-circle-outline",size:"24",onClick:e[1]||(e[1]=d=>S("add"))}),l("div",{class:"name",onClick:e[2]||(e[2]=d=>S("add"))},"添加题目类型")])):m("",!0)]),t.formType=="TEXT"?(s(),C(o,{key:0,modelValue:t.value,"onUpdate:modelValue":d=>t.value=d,placeholder:t.attrItemJson},null,8,["modelValue","onUpdate:modelValue","placeholder"])):m("",!0),c(h,null,{default:r(()=>[t.formType=="TEXTAREA"?(s(),C(o,{key:0,modelValue:t.value,"onUpdate:modelValue":d=>t.value=d,type:"textarea",placeholder:t.attrItemJson,rows:6},null,8,["modelValue","onUpdate:modelValue","placeholder"])):m("",!0)]),_:2},1024),t.formType=="SELECT"||t.formType=="TABS"?(s(),C(A,{key:1,transfer:!0,modelValue:t.value,"onUpdate:modelValue":d=>t.value=d,style:{"max-width":"50%"}},{default:r(()=>[(s(!0),u(k,null,O(t.attrItemJson.split(";"),(d,v)=>(s(),C(T,{value:d,key:v},{default:r(()=>[D(N(d),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):m("",!0),c(h,null,{default:r(()=>[t.formType=="DATE"?(s(),C(b,{key:0,type:"date",modelValue:t.value,"onUpdate:modelValue":d=>t.value=d,placeholder:t.attrItemJson},null,8,["modelValue","onUpdate:modelValue","placeholder"])):m("",!0)]),_:2},1024),c(h,null,{default:r(()=>[t.formType=="RADIO"?(s(),C(ce,{key:0,modelValue:t.value,"onUpdate:modelValue":d=>t.value=d},{default:r(()=>[(s(!0),u(k,null,O(t.attrItemJson.split(";"),(d,v)=>(s(),C(x,{value:d,label:d},null,8,["value","label"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])):m("",!0)]),_:2},1024),c(h,null,{default:r(()=>[t.formType=="UPLOAD_FILE"?(s(),u("div",Ke,[l("div",Xe,[c(J,{id:"cImage-upload",format:["pdf","doc","docx"],modeType:"freedom",onUploadSuccess:d=>de(W,d)},{content:r(()=>[l("div",We,[t.value?(s(),u("div",He,Qe)):(s(),u(k,{key:1},[c(n,{type:"ios-cloud-upload",size:"40"}),je],64))])]),_:2},1032,["onUploadSuccess"])])])):m("",!0),t.formType=="EXAMINATION_COMPONENT"?(s(),u("div",Ye,[(s(!0),u(k,null,O(_.value,(d,v)=>(s(),u("div",{class:"dataList-item",key:v},[c(A,{class:"select",modelValue:_.value[v].type,"onUpdate:modelValue":g=>_.value[v].type=g},{default:r(()=>[(s(!0),u(k,null,O(j.value,g=>(s(),C(T,{value:g.value},{default:r(()=>[D(N(g.name),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"]),l("div",Ze,[ea,c(K,{min:1,modelValue:_.value[v].num,"onUpdate:modelValue":g=>_.value[v].num=g},null,8,["modelValue","onUpdate:modelValue"])]),l("div",aa,[oa,c(K,{min:1,modelValue:_.value[v].score,"onUpdate:modelValue":g=>_.value[v].score=g},null,8,["modelValue","onUpdate:modelValue"])]),l("div",ta,[c(n,{type:"ios-remove-circle-outline",size:"25",onClick:g=>S("reduce",v)},null,8,["onClick"])])]))),128))])):m("",!0)]),_:2},1024),c(h,null,{default:r(()=>[t.formType=="KNOWLEDGE_COMPONENT"?(s(),u(k,{key:0},[c(X,{onClick:d=>le(t)},{default:r(()=>[D("选择知识库")]),_:2},1032,["onClick"]),l("div",la,[(s(!0),u(k,null,O(t.knowledgeList,(d,v)=>(s(),u("div",sa,[l("div",na,[d.avatar?(s(),u("img",{key:0,src:d.avatar},null,8,da)):(s(),u("img",ua))]),l("div",{class:"item-name text-hide",title:d.name},N(d.name),9,ca),c(n,{type:"md-close-circle",size:"15",onClick:g=>ne(t,v),class:"item-close"},null,8,["onClick"])]))),256))])],64)):m("",!0)]),_:2},1024),c(h,null,{default:r(()=>[t.formType=="UPLOAD_IMAGE"?(s(),C(J,{key:0,url:t.value,"onUpdate:url":d=>t.value=d,format:["jpg","jpeg","gif","png","bmp","webp"],limit:30,multiple:!0,onUploadSuccess:d=>ue(t,d)},null,8,["url","onUpdate:url","onUploadSuccess"])):m("",!0)]),_:2},1024)]))),128))])],64)):m("",!0)],64))])]),_:1},8,["modelValue"]),c(pe,{ref_key:"addBaseRef",ref:q,onInit:se},null,512)]),_:1})}}});const wa=ke(ga,[["__scopeId","data-v-00275983"]]);export{wa as _};
